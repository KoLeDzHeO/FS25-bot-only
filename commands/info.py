from __future__ import annotations

import discord
from discord import app_commands

from utils.logger import log_debug
from pause_guard import pause_guard

INFO_TEXT = (
    "\U0001f4ca Информация о боте статистики активности\n"
    "\n"
    "Этот бот отслеживает активность игроков на сервере и ведёт учёт времени, проведённого в онлайне. Вот как это работает:\n"
    "\n"
    "\U0001f504 Как считается 1 час онлайна?\n"
    "- Бот проверяет список игроков каждые 15 минут.\n"
    "- Если за 1 час ты был в онлайне минимум 3 раза (примерно 45 минут в сумме), этот час будет засчитан как активный.\n"
    "\n"
    "\U0001f4c5 Как часто обновляется статистика?\n"
    "- Проверки активности (срезы) происходят каждые 15 минут.\n"
    "- Суммарное время (таблица player_total_time) обновляется раз в час.\n"
    "\n"
    "\U0001f570\ufe0f Если ты давно не заходил\n"
    "- Твоё накопленное время не исчезает.\n"
    "- Детальные записи об онлайне хранятся 30 дней, но итоговые часы сохраняются навсегда.\n"
    "\n"
    "\U0001f4e5 Что показывает Excel-файл при экспорте?\n"
    "- В статистике отображаются:\n"
    "  - Твой никнейм\n"
    "  - Общее количество часов\n"
    "  - Дата последнего обновления твоей статистики\n"
    "\n"
    "\U0001f4cc Что нужно, чтобы бот начал считать твой онлайн?\n"
    "- В течение 1 часа ты должен попасть в онлайн минимум 3 раза\n"
    "- Никаких дополнительных условий (например, минимум часов в неделю) нет\n"
    "\n"
    "\U0001f464 Автор бота: <@288650612051017730>"
)


def setup(tree: app_commands.CommandTree) -> None:
    @tree.command(name="info", description="Информация о том, как работает бот")
    @pause_guard
    async def info_command(interaction: discord.Interaction) -> None:
        await interaction.response.send_message(INFO_TEXT)

    log_debug("[Slash] Команда /info зарегистрирована")
